

  <p-toolbar styleClass="mb-6">
        <ng-template pTemplate="start">
          <p-button label="Nuevo" icon="pi pi-plus" class="p-button-success mr-2" class="mr-2"  (onClick)="openCreateModal()"></p-button>
        </ng-template>
        
        <ng-template pTemplate="end">
          <p-button #btnMatFiltros label="Filtros" icon="pi pi-filter"
                severity="secondary"
                (click)="toggleFilterPopover($event, btnMatFiltros.el.nativeElement)"></p-button>
        </ng-template>
  </p-toolbar>
  <p-table
    #dtMateriales
    [value]="store.materiales()"
    [tableStyle]="{ 'min-width': '90rem' }" [paginator]="true"
    [rows]="store.perPage()"
    [totalRecords]="store.totalItems()"
    (onPage)="onPageChange($event)"
    [showCurrentPageReport]="true"
    responsiveLayout="scroll"
    [rowHover]="true"
    dataKey="id"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} materiales"
    [globalFilterFields]="['id', 'cod_articulo', 'nombre', 'descripcion', 'categoria.nombre', 'proveedor.nombre', 'color.nombre']"
    [lazy]="true"
    styleClass="p-datatable-customers p-datatable-gridlines">

    <ng-template pTemplate="caption">
      <div class="flex items-center justify-between">
        <p class="font-bold font-mono text-2xl py-1" >MATERIALES</p>
      </div>
    </ng-template>


    <ng-template pTemplate="header">
      <tr>
        <th style="width: 5%; min-width: 4rem;" pSortableColumn="id">ID <p-sortIcon field="id"></p-sortIcon></th>
        <th pSortableColumn="cod_articulo" style="min-width:10rem">Cód. Artículo <p-sortIcon field="cod_articulo"></p-sortIcon></th>
        <th pSortableColumn="nombre" style="min-width:10rem">Nombre <p-sortIcon field="nombre"></p-sortIcon></th>
        <th style="min-width:10rem">Categoría</th>
        <th style="min-width:10rem">Proveedor</th>
        <th style="min-width:8rem">Color</th>
        <th style="min-width:8rem" pSortableColumn="estado">Estado <p-sortIcon field="estado"></p-sortIcon></th>
        <th style="width:12rem">Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-material>
      <tr>
        <td>{{ material.id }}</td>
        <td>{{ material.cod_articulo }}</td>
        <td>{{ material.nombre }}</td>
        <td>{{ material.categoria?.nombre || 'N/A' }}</td> <td>{{ material.proveedor?.nombre || 'N/A' }}</td> <td>{{ material.color?.nombre || 'N/A' }}</td>
        <td>
          <p-tag [value]="getTextForEstado(material.estado)" [severity]="getSeverityForEstado(material.estado)"></p-tag>
        </td>
        <td>
                <div class="flex gap-2">
                   <p-button icon="pi pi-eye" [rounded]="true" [outlined]="true" severity="info"
                        (click)="store.openModalDetalle(material)" pTooltip="Ver Detalle" tooltipPosition="top"/>
                    <p-button icon="pi pi-pencil" [rounded]="true" [outlined]="true"
                        (click)="store.openModalEdit(material)" pTooltip="Editar" tooltipPosition="top"/>
                    
                    @if (material.estado) {
                        <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true"
                            (click)="confirmDelete(material.id)" pTooltip="Desactivar" tooltipPosition="top"/>
                    } @else {
                        <p-button icon="pi pi-history" severity="warn" [rounded]="true" [outlined]="true"
                            (click)="store.doRestore(material.id)" pTooltip="ACtivar" tooltipPosition="top"/>
                    }
                </div>
            </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="8" class="text-center">No se encontraron materiales.</td> </tr>
    </ng-template>
    <ng-template pTemplate="loadingbody">
        <tr>
            <td colspan="8" class="text-center">Cargando materiales...</td> </tr>
    </ng-template>
  </p-table>
  
<p-toast></p-toast>
<app-create />
<app-edit />
<app-filtro />
<app-detalle />
<p-confirmDialog acceptLabel="Sí"></p-confirmDialog>

